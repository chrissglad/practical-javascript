<!DOCTYPE html>

<html>
  <head>
    <title>Practical JavaScript</title>
  </head>

  <body>
    <script src="babel-standalone.js"></script>
    <script src="uuid.js"></script>
    <script type="text/babel">
      const LOCAL_STORAGE_KEY = "pj_todos";

      class PJTodos {
        constructor() {
          this.useLocalStorage = typeof localStorage !== undefined;

          if (this.useLocalStorage) {
            let lsItems = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (lsItems === null) {
              this.todoMap = {
                todos: [],
              };
            } else {
              this.todoMap = JSON.parse(lsItems);
            }
            console.log(this.todoMap.todos);
          }
        }

        //add item
        addTodo(initialTodoText) {
          if (this.useLocalStorage) {
            let { todos } = this.todoMap;
            let newTodo = {
              todoText: initialTodoText,
              isCompleted: false,
              createdAt: new Date().toLocaleString(),
              updatedAt: new Date().toLocaleString(),
            }
            todos.push(todo)
            console.log(todos);
            return this.saveTodosInLocalStorage(todos);
          }
        }

        //edit item
        editTodo(position, newTodoText) {
          if (this.useLocalStorage) {
            let { todos } = this.todoMap;
            let todo = todos[position];
            todo.todoText = newTodoText;
            todo.updatedAt = new Date().toLocaleString();
            console.log(todos);
            return this.saveTodosInLocalStorage(todos);
          }
        }

        //remove item
        removeTodo(position) {
          if (this.useLocalStorage) {
            let { todos } = this.todoMap;
            todos.splice(position, 1);
            console.log(todos);
            return this.saveTodosInLocalStorage(todos);
          }
        }

        // clear items
        clearTodos() {
          if (this.useLocalStorage) {
            if (localStorage.getItem(LOCAL_STORAGE_KEY) !== null)
              return localStorage.removeItem(LOCAL_STORAGE_KEY);
          }
        }

        // save todos to localstorage
        saveTodosInLocalStorage(todos) {
          localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify({ todos }));
        }
      }

      const pjTodos = new PJTodos()

      // pjTodos.addTodo('hello world')
    </script>
  </body>
</html>
